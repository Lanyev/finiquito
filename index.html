<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculadora Finiquito vs. Liquidaci√≥n (MX 2025)</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <header class="header-section">
        <h1>Calculadora Finiquito y Liquidaci√≥n (MX 2025)</h1>
        <p class="sub">
          C√°lculo para Ciudad Ju√°rez (ZLFN: $419.88 MXN).
          <strong>Prima vacacional NO incluida</strong> (LFT art. 80 la
          reconoce; aqu√≠ se excluye por indicaci√≥n).
        </p>
      </header>

      <section class="form-section">
        <h2 class="section-title">Datos del Trabajador</h2>

        <div class="form-grid">
          <div class="form-group">
            <label for="salarioDiario">Salario diario (MXN)</label>
            <input
              type="number"
              id="salarioDiario"
              min="0"
              step="0.01"
              value="500"
              placeholder="Ej: 500.00"
            />
          </div>

          <div class="form-group">
            <label for="diasAguinaldo">Aguinaldo anual (d√≠as)</label>
            <input
              type="number"
              id="diasAguinaldo"
              min="15"
              step="1"
              value="15"
              placeholder="M√≠nimo 15"
            />
          </div>

          <div class="form-group">
            <label for="fechaIngreso">Fecha de ingreso</label>
            <input type="date" id="fechaIngreso" value="2022-01-01" />
          </div>

          <div class="form-group">
            <label for="fechaBaja">Fecha de baja</label>
            <input type="date" id="fechaBaja" />
          </div>

          <div class="form-group full-width">
            <label for="diasVacPend"
              >Vacaciones pendientes por pagar (d√≠as)</label
            >
            <input
              type="number"
              id="diasVacPend"
              min="0"
              step="0.5"
              value="0"
              placeholder="Solo d√≠as no gozados"
            />
            <div class="hint">
              Solo los d√≠as que no ha gozado. La prima vacacional (m√≠n. 25%) no
              est√° siendo considerada en el monto final.
            </div>
          </div>
        </div>

        <div class="checkbox-section">
          <div class="checkbox-group">
            <input type="checkbox" id="inc20" />
            <label for="inc20"
              >Incluir <strong>20 d√≠as por a√±o</strong> (Art. 50 LFT)</label
            >
            <span class="hint">‚Äî apagado por defecto</span>
          </div>
          <div class="help-link">
            ¬øCu√°ndo procede? üëâ
            <a
              href="https://mexico.justia.com/federales/leyes/ley-federal-del-trabajo/titulo-segundo/capitulo-iv/"
              target="_blank"
              rel="noopener"
            >
              Consulta Art. 50 LFT (Justia)
            </a>
          </div>
        </div>

        <div class="actions">
          <button class="primary" id="btnCalc">
            <span>üìä</span>
            Calcular
          </button>
          <button class="ghost" id="btnClear">
            <span>üóëÔ∏è</span>
            Limpiar
          </button>
        </div>
      </section>

      <section class="results-section">
        <h2 class="section-title">Resultados del C√°lculo</h2>

        <div class="info-cards">
          <div class="info-card">
            <h3>üìä Datos de Servicio</h3>
            <div class="data-row">
              <span>A√±os completos</span>
              <strong id="aniosCompletos">0</strong>
            </div>
            <div class="data-row">
              <span>D√≠as proporcionales a√±o en curso</span>
              <strong id="diasAnio">0</strong>
            </div>
          </div>

          <div class="info-card">
            <h3>üí∞ Proporcionales y Prima de Antig√ºedad</h3>
            <div class="data-row">
              <span>Aguinaldo proporcional</span>
              <strong id="aguinaldo">$0.00</strong>
            </div>
            <div class="data-row">
              <span>Vacaciones (d√≠as pendientes)</span>
              <strong id="vac">$0.00</strong>
            </div>
            <div class="data-row">
              <span>Prima de antig√ºedad (Base total)</span>
              <strong id="primaAntiguedadTotal">$0.00</strong>
            </div>
          </div>
        </div>

        <div class="main-results">
          <div class="result-card finiquito-card">
            <div class="card-header">
              <h3>‚úÖ FINIQUITO</h3>
              <span class="card-subtitle"
                >Monto M√≠nimo por Renuncia o Mutuo Acuerdo</span
              >
            </div>
            <div class="calculation-details">
              <div class="data-row">
                <span
                  >Suma de Proporcionales + Prima de Antig√ºedad (si
                  aplica)</span
                >
                <strong id="subTotalFiniquito">$0.00</strong>
              </div>
            </div>
            <div class="total-amount" id="totFiniquito">$0.00 MXN</div>
            <div class="card-note">
              La <strong>prima de antig√ºedad en renuncia</strong> solo aplica si
              hay <strong>‚â• 15 a√±os</strong> de servicio; en despido aplica
              siempre (tope $2 \times$ SM).
            </div>
          </div>

          <div class="result-card liquidacion-card">
            <div class="card-header">
              <h3>‚öñÔ∏è LIQUIDACI√ìN</h3>
              <span class="card-subtitle"
                >Referencia M√°xima / Despido Injustificado</span
              >
            </div>
            <div class="calculation-details">
              <div class="data-row">
                <span>Finiquito Base (Total)</span>
                <strong id="baseFiniquito">$0.00</strong>
              </div>
              <div class="data-row">
                <span>Indemnizaci√≥n 3 meses (90 d√≠as)</span>
                <strong id="indem3">$0.00</strong>
              </div>
              <div class="data-row">
                <span>20 d√≠as por a√±o (opcional)</span>
                <strong id="v20">$0.00</strong>
              </div>
            </div>
            <div class="total-amount" id="totLiquida">$0.00 MXN</div>
            <div class="card-note">
              Los <strong>20 d√≠as por a√±o</strong> solo proceden bajo supuestos
              espec√≠ficos (p. ej., negativa de reinstalaci√≥n tras juicio, Art.
              50 LFT).
            </div>
          </div>
        </div>
      </section>

      <footer class="footer-section">
        <p class="disclaimer">
          ‚ö†Ô∏è <strong>C√°lculo informativo.</strong> Revisa tu contrato/CPR y
          consulta a un profesional o PROFEDET para tu caso espec√≠fico.
        </p>
      </footer>
    </div>
    <script>
      // === Par√°metros fijos (Ciudad Ju√°rez) ===
      const SM_ZLFN = 419.88; // Salario M√≠nimo Diario Zona Libre Frontera Norte (editable)
      const PRIMA_VAC_PCT = 0; // 0% por indicaci√≥n del usuario (no se incluye prima vacacional)

      // Helpers
      const fmt = (n) =>
        new Intl.NumberFormat('es-MX', {
          style: 'currency',
          currency: 'MXN',
        }).format(n);
      const diasEntre = (a, b) =>
        Math.max(0, Math.floor((b - a) / (1000 * 60 * 60 * 24)));
      const inicioDeAnio = (d) => new Date(d.getFullYear(), 0, 1);

      // La funci√≥n calcular() ahora incluye la l√≥gica para GUARDAR en localStorage
      function calcular() {
        // Entradas
        const sd = parseFloat(document.getElementById('salarioDiario').value);
        const diasAguinaldo = parseFloat(
          document.getElementById('diasAguinaldo').value
        );
        const fechaIngreso = new Date(
          document.getElementById('fechaIngreso').value + 'T00:00:00'
        );
        const fechaBaja = new Date(
          document.getElementById('fechaBaja').value + 'T00:00:00'
        );
        const diasVacPend = parseFloat(
          document.getElementById('diasVacPend').value || 0
        );
        const inc20 = document.getElementById('inc20').checked;

        if (!sd || !diasAguinaldo || !(fechaIngreso < fechaBaja)) {
          alert(
            'Verifica salario, aguinaldo (‚â•15) y que la fecha de ingreso sea anterior a la de baja.'
          );
          return;
        }

        // Antig√ºedad total y a√±os completos (base 365 d√≠as)
        const totalDias = diasEntre(fechaIngreso, fechaBaja);
        const aniosCompletos = Math.floor(totalDias / 365);

        // D√≠as trabajados del a√±o en curso (desde 1 de enero hasta fechaBaja)
        const diasAnio = diasEntre(inicioDeAnio(fechaBaja), fechaBaja);

        // --- Proporcionales ---
        const aguinaldoProp = sd * (diasAguinaldo * (diasAnio / 365));
        const vacMonto = diasVacPend * sd;
        const primaVac = vacMonto * PRIMA_VAC_PCT;

        // --- Prima de antig√ºedad (art. 162 LFT) ---
        const salarioTope = Math.min(sd, SM_ZLFN * 2);
        const primaAntig = 12 * aniosCompletos * salarioTope;

        // --- FINIQUITO (Renuncia/Mutuo acuerdo) ---
        const paRenuncia = aniosCompletos >= 15 ? primaAntig : 0;
        const subTotalFiniquito =
          aguinaldoProp + vacMonto + primaVac + paRenuncia;
        const finiquitoTotal = subTotalFiniquito;

        // --- LIQUIDACI√ìN (Despido injustificado) ---
        const indem3 = 90 * sd;
        const veintePorAnio = inc20 ? 20 * aniosCompletos * sd : 0;
        const liquidaTotal =
          indem3 +
          veintePorAnio +
          primaAntig +
          aguinaldoProp +
          vacMonto +
          primaVac;

        // Pintar en UI
        document.getElementById('aniosCompletos').textContent = aniosCompletos;
        document.getElementById('diasAnio').textContent = diasAnio;

        document.getElementById('aguinaldo').textContent = fmt(aguinaldoProp);
        document.getElementById('vac').textContent = fmt(vacMonto);
        document.getElementById('primaAntiguedadTotal').textContent =
          fmt(primaAntig);

        document.getElementById('subTotalFiniquito').textContent =
          fmt(subTotalFiniquito);
        document.getElementById('totFiniquito').textContent =
          fmt(finiquitoTotal) + ' MXN';

        document.getElementById('baseFiniquito').textContent =
          fmt(finiquitoTotal);
        document.getElementById('indem3').textContent = fmt(indem3);
        document.getElementById('v20').textContent = inc20
          ? fmt(veintePorAnio)
          : '‚Äî (opci√≥n desactivada)';
        document.getElementById('totLiquida').textContent =
          fmt(liquidaTotal) + ' MXN';

        // === L√ìGICA DE GUARDADO EN LOCAL STORAGE ===
        const datosGuardar = {
          salarioDiario: sd,
          diasAguinaldo: diasAguinaldo,
          fechaIngreso: document.getElementById('fechaIngreso').value,
          fechaBaja: document.getElementById('fechaBaja').value,
          diasVacPend: diasVacPend,
          inc20: inc20,
        };
        localStorage.setItem('ultimoCalculoMX', JSON.stringify(datosGuardar));
        // ===========================================
      }

      function limpiar() {
        document.getElementById('salarioDiario').value = 500;
        document.getElementById('diasAguinaldo').value = 15;
        document.getElementById('fechaIngreso').value = '2022-01-01';
        document.getElementById('fechaBaja').valueAsDate = new Date();
        document.getElementById('diasVacPend').value = 0;
        document.getElementById('inc20').checked = false;
        [
          'aniosCompletos',
          'diasAnio',
          'aguinaldo',
          'vac',
          'primaAntiguedadTotal',
          'subTotalFiniquito',
          'baseFiniquito',
          'indem3',
          'v20',
        ].forEach(
          (id) =>
            (document.getElementById(id).textContent =
              id === 'v20'
                ? '‚Äî (opci√≥n desactivada)'
                : id === 'aniosCompletos' || id === 'diasAnio'
                ? '0'
                : '$0.00')
        );
        document.getElementById('totFiniquito').textContent = '$0.00 MXN';
        document.getElementById('totLiquida').textContent = '$0.00 MXN';

        // Opcional: limpiar localStorage al presionar el bot√≥n de limpiar
        localStorage.removeItem('ultimoCalculoMX');
      }

      // === L√ìGICA DE CARGA DESDE LOCAL STORAGE ===
      function cargarCalculoGuardado() {
        const ultimoCalculo = localStorage.getItem('ultimoCalculoMX');
        const hoy = new Date();

        if (ultimoCalculo) {
          const data = JSON.parse(ultimoCalculo);

          // Cargar valores al formulario
          document.getElementById('salarioDiario').value = data.salarioDiario;
          document.getElementById('diasAguinaldo').value = data.diasAguinaldo;
          document.getElementById('fechaIngreso').value = data.fechaIngreso;
          document.getElementById('fechaBaja').value = data.fechaBaja;
          document.getElementById('diasVacPend').value = data.diasVacPend;
          document.getElementById('inc20').checked = data.inc20;

          // Ejecutar el c√°lculo autom√°ticamente para mostrar los resultados
          calcular();
        } else {
          // Si no hay c√°lculo guardado, solo inicializa la fecha de baja a hoy
          document.getElementById('fechaBaja').valueAsDate = hoy;
        }
      }

      document.getElementById('btnCalc').addEventListener('click', calcular);
      document.getElementById('btnClear').addEventListener('click', limpiar);

      // Ejecutar la carga al iniciar
      window.addEventListener('load', cargarCalculoGuardado);
    </script>
  </body>
</html>
